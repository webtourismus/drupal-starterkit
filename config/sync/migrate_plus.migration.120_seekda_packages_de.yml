uuid: 2cb02063-8b80-4c5f-a182-fabce502aaa6
langcode: de
status: true
dependencies: {  }
_core:
  default_config_hash: HpiLnaWE8xi4juUXiX2qRK3hzPzTYqqRoGLGEO8KOcw
id: 120_seekda_packages_de
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags: null
migration_group: seekda
label: '120 - Seekda packages (german)'
source:
  plugin: url
  headers:
    Accept: application/json
  data_fetcher_plugin: http
  data_parser_plugin: json
  urls:
    callback: ebr_accommodation_seekda_migration_120_seekda_packages_de
  item_selector: /result/packages
  track_changes: true
  fields:
    -
      name: package_code
      selector: code
    -
      name: package_title
      selector: title
    -
      name: teaser
      selector: teaser
    -
      name: description
      selector: description
    -
      name: meal_plan
      selector: meal_plan_code
    -
      name: images
      selector: imagesInfo
    -
      name: min_los
      selector: min_los_per_week_day
    -
      name: rate_type
      selector: type
    -
      name: categories
      selector: category_codes
    -
      name: rates
      selector: rooms
  constants:
    remote_datasource: seekda
    images_upload_directory: 'public://seekda/'
  ids:
    package_code:
      type: string
process:
  type:
    plugin: default_value
    default_value: package
  title: package_title
  langcode:
    plugin: default_value
    default_value: de
  uid:
    plugin: default_value
    default_value: 1
  status:
    plugin: default_value
    default_value: 1
  sticky:
    plugin: default_value
    default_value: 0
  promote:
    plugin: default_value
    default_value: 0
  field_subtitle/value: teaser
  field_subtitle/format:
    plugin: default_value
    default_value: basic_html
  body/value: description
  body/format:
    plugin: default_value
    default_value: basic_html
  remote_datasource: constants/remote_datasource
  remote_id: package_code
  field_images:
    -
      plugin: sub_process
      source: images
      include_source: true
      source_key: root
      process:
        remote_datasource: root/constants/remote_datasource
        images_upload_directory: root/constants/images_upload_directory
        image_source_url: url
        title: title
        image_basename:
          -
            plugin: callback
            callable: parse_url
            source: url
          -
            plugin: extract
            index:
              - path
          -
            plugin: callback
            callable: basename
          -
            plugin: callback
            callable: urldecode
    -
      plugin: sub_process
      process:
        remote_datasource: remote_datasource
        image_source_url: image_source_url
        title: title
        image_basename: image_basename
        media_title_fallback:
          -
            plugin: callback
            callable: pathinfo
            source: image_basename
          -
            plugin: extract
            index:
              - filename
        image_target_uri:
          -
            plugin: concat
            source:
              - images_upload_directory
              - image_basename
    -
      plugin: sub_process
      process:
        remote_datasource: remote_datasource
        image_source_url: image_source_url
        media_entity_title:
          plugin: null_coalesce
          source:
            - title
            - media_title_fallback
        image_file_id:
          -
            plugin: download
            file_exists: 'use existing'
            source:
              - image_source_url
              - image_target_uri
          -
            plugin: entity_generate
            entity_type: file
            bundle: 1
            bundle_key: status
            value_key: uri
            ignore_case: false
            access_check: false
            default_values:
              langcode: de
              status: 1
              uid: 1
            values:
              filename: image_basename
              uri: image_target_uri
    -
      plugin: sub_process
      process:
        target_id:
          plugin: entity_generate
          entity_type: media
          bundle: image
          bundle_key: bundle
          value_key: remote_id
          source: image_source_url
          ignore_case: false
          access_check: false
          default_values:
            bundle: image
            langcode: de
            status: 1
            uid: 1
          values:
            name: media_entity_title
            remote_id: image_source_url
            remote_datasource: remote_datasource
            field_media_image/target_id: image_file_id
  field_mealplan:
    plugin: static_map
    source: meal_plan
    map:
      1: AI
      10: FB
      11: BF
      12: HB
      100: EHB
    bypass: true
  field_minlos:
    -
      plugin: skip_on_empty
      method: process
      source: min_los
    -
      plugin: single_value
    -
      plugin: callback
      callable: min
  field_price:
    plugin: seekda_minprice
    source: rates
    round_cents_to_full: 0.04
    price_per_person: true
destination:
  plugin: 'entity:node'
  overwrite_properties:
    - remote_datasource
    - remote_id
    - status
    - title
    - field_subtitle
    - body
    - field_images
    - field_price
    - field_minlos
    - field_mealplan
migration_dependencies:
  required:
    - 100_seekda_rooms_de
